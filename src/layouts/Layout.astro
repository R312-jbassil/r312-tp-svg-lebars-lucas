---
import "../styles/global.css";
import { ui, defaultLang } from '../i18n/ui.js';

// Props du layout
interface Props {
  title?: string;
  currentPage?: string;
}

const { title = "GÃ©nÃ©rateur SVG", currentPage = "" } = Astro.props;

// RÃ©cupÃ©ration de la langue actuelle (cookie ou dÃ©faut)
const currentLanguage = Astro.cookies.get("language")?.value || defaultLang;

// Validation et dÃ©finition de la locale - assurer que c'est soit 'fr' soit 'en'
const validLocales = ['fr', 'en'] as const;
type ValidLocale = typeof validLocales[number];
const locale: ValidLocale = validLocales.includes(currentLanguage as ValidLocale) ? currentLanguage as ValidLocale : defaultLang;

// DÃ©terminer le titre basÃ© sur la page actuelle ou utiliser le titre fourni
let pageTitle = title;
if (currentPage === "home") pageTitle = ui[locale].index.title;
else if (currentPage === "generator") pageTitle = ui[locale].generator.title;
else if (currentPage === "library") pageTitle = ui[locale].gallery.title;
---

<!doctype html>
<html lang={locale} data-theme="dark" class="h-full">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
		<link href="https://cdn.jsdelivr.net/npm/daisyui@3.8.0/dist/full.css" rel="stylesheet" type="text/css" />
		<script src="https://cdn.tailwindcss.com"></script>
		<slot name="head" />
	</head>
	<body class="h-full bg-gray-900">
		<div class="h-full flex flex-col min-h-0">
			<!-- Navigation horizontale en haut -->
			<nav class="bg-gray-800 shadow-lg border-b border-gray-700">
				<div class="px-6 py-3">
					<div class="flex justify-between items-center">
						<div class="flex space-x-8">
							<a 
								href="/" 
								class={`font-medium transition-colors ${currentPage === 'home' ? 'text-violet-400 border-b-2 border-violet-500 pb-1' : 'text-gray-300 hover:text-violet-400'}`}
							>
								{ui[locale].nav.home}
							</a>
							{Astro.locals.user && (
								<>
									<a 
										href="/generator" 
										class={`font-medium transition-colors ${currentPage === 'generator' ? 'text-violet-400 border-b-2 border-violet-500 pb-1' : 'text-gray-300 hover:text-violet-400'}`}
									>
										{ui[locale].nav.generator}
									</a>
									<a 
										href="/library" 
										class={`font-medium transition-colors ${currentPage === 'library' ? 'text-violet-400 border-b-2 border-violet-500 pb-1' : 'text-gray-300 hover:text-violet-400'}`}
									>
										{ui[locale].nav.gallery}
									</a>
								</>
							)}
						</div>
						
						<div class="flex items-center space-x-4">
							<!-- Informations utilisateur -->
							{Astro.locals.user ? (
								<div class="flex items-center space-x-3">
									<span class="text-sm text-gray-300">
										{ui[locale].nav.hello}, <span class="text-violet-400">{Astro.locals.user.email}</span>
									</span>
									<form method="POST" action="/api/logout" class="m-0 p-0 ml-4">
										<button type="submit" class="btn btn-primary">Logout</button>
									</form>
								</div>
							) : (
								<a 
									href="/login" 
									class="text-sm bg-violet-600 hover:bg-violet-700 text-white px-4 py-2 rounded-md transition-colors"
								>
									{ui[locale].nav.login}
								</a>
							)}
							
							<!-- SÃ©lecteur de langue -->
							<form method="POST" action="/api/setLanguage" class="flex items-center">
								<input type="hidden" name="returnUrl" value={Astro.url.pathname} />
								<select 
									name="language" 
									class="select select-sm bg-gray-700 border-gray-600 text-gray-200 focus:border-violet-500 focus:ring-violet-500" 
									onchange="this.form.submit()"
								>
									<option disabled selected={!currentLanguage}>{ui[locale].nav.language}</option>
									<option value="en" selected={currentLanguage === "en"}>ðŸ‡¬ðŸ‡§ English</option>
									<option value="fr" selected={currentLanguage === "fr"}>ðŸ‡«ðŸ‡· FranÃ§ais</option>
								</select>
							</form>
						</div>
					</div>
				</div>
			</nav>
			
			<!-- Contenu de la page -->
			<div class="flex-1 min-h-0">
				<slot />
			</div>
		</div>
		
		<!-- Scripts partagÃ©s -->
		<slot name="scripts" />
		

	</body>
</html>